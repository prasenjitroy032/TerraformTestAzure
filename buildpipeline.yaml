pool:
  name: Default
steps:
- task: ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0
  displayName: 'Use Terraform Latest'
  inputs:
    terraformVersion: v0.14.11

- task: ms-devlabs.custom-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
  displayName: 'Terraform : INIT'
  inputs:
    backendServiceArm: 'PR-TFSPN'
    backendAzureRmResourceGroupName: 'pr-infra'
    backendAzureRmStorageAccountName: prtstate
    backendAzureRmContainerName: tstate
    backendAzureRmKey: 'JOKRBrj77iD6J3RmDriTuxlxqmIKkkXg+jK53feg7VK6YntQP4wYROTi6+jEld6wpTmS602oTE3wCjDGkyeOiA=='

- task: ms-devlabs.custom-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
  displayName: 'Terraform : PLAN'
  inputs:
    command: plan
    environmentServiceNameAzureRM: 'PR-TFSPN'

- task: ms-devlabs.custom-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
  displayName: 'Terraform : VALIDATE & APPLY'
  inputs:
    command: apply
    environmentServiceNameAzureRM: 'PR-TFSPN'
